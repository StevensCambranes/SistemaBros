<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vista Inventario</title>
  <link rel="stylesheet" href="Style.css/Vista_Inventario.css" />
  <!-- Importar SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

  <header>
    <h1>Vista Inventario</h1>
  </header>

  <main class="inventario-main">
    <table>
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio Unitario</th>
          <th>Fecha Ingreso</th>
          <th>Cantidad</th>
          <th>Medida</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tbodyInventario">
        <!-- filas generadas din√°micamente -->
      </tbody>
    </table>

    <div class="buttons">
      <button id="btnAgregar" class="btn btn-blue">Agregar</button>
      <button id="btnVenta" class="btn btn-green">Venta</button>
      <button id="btnMerma" class="btn btn-orange">Desperdicio</button>
    </div>
  </main>

  <script>
    const tbody = document.getElementById('tbodyInventario');
    let datos = JSON.parse(localStorage.getItem('inventario')) || [];

    function renderTabla() {
      tbody.innerHTML = '';
      datos.forEach((item, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.producto}</td>
          <td>Q ${item.precio}</td>
          <td>${item.fecha}</td>
          <td>${item.cantidad}</td>
          <td>${item.medida}</td>
          <td class="actions">
            <button class="icon-btn edit" data-index="${idx}">‚úçÔ∏è</button>
            <button class="icon-btn delete" data-index="${idx}">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    renderTabla();

    tbody.addEventListener('click', async e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const idx = parseInt(btn.dataset.index, 10);

      if (btn.classList.contains('delete')) {
        const result = await Swal.fire({
          title: '¬øEliminar producto?',
          text: 'Esta acci√≥n no se puede deshacer.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'S√≠, eliminar',
          cancelButtonText: 'Cancelar'
        });

        if (result.isConfirmed) {
          datos.splice(idx, 1);
          localStorage.setItem('inventario', JSON.stringify(datos));
          renderTabla();
          Swal.fire({
            icon: 'success',
            title: 'Eliminado',
            text: 'El producto fue eliminado correctamente.',
            confirmButtonColor: '#3085d6'
          });
        }
      }

      if (btn.classList.contains('edit')) {
        const item = datos[idx];

        const { value: nuevoProd } = await Swal.fire({
          title: 'Editar producto',
          input: 'text',
          inputLabel: 'Nombre del producto',
          inputValue: item.producto,
          showCancelButton: true,
          confirmButtonText: 'Guardar',
          cancelButtonText: 'Cancelar'
        });
        if (!nuevoProd) return;

        const { value: nuevaCant } = await Swal.fire({
          title: 'Editar cantidad',
          input: 'number',
          inputLabel: 'Cantidad',
          inputValue: item.cantidad,
          showCancelButton: true,
          confirmButtonText: 'Guardar',
          cancelButtonText: 'Cancelar'
        });
        if (!nuevaCant) return;

        const { value: nuevoPrecio } = await Swal.fire({
          title: 'Editar precio',
          input: 'text',
          inputLabel: 'Precio unitario (Q)',
          inputValue: item.precio,
          showCancelButton: true,
          confirmButtonText: 'Guardar',
          cancelButtonText: 'Cancelar'
        });
        if (!nuevoPrecio) return;

        const { value: nuevaFecha } = await Swal.fire({
          title: 'Editar fecha',
          input: 'text',
          inputLabel: 'Fecha (DD-MM-YYYY)',
          inputValue: item.fecha,
          showCancelButton: true,
          confirmButtonText: 'Guardar',
          cancelButtonText: 'Cancelar'
        });
        if (!nuevaFecha) return;

        const { value: nuevaMedida } = await Swal.fire({
          title: 'Editar medida',
          input: 'select',
          inputOptions: {
            'Unidad': 'Unidad',
            'Gr': 'Gramo',
            'Kg': 'Kilogramo',
            'Oz': 'Onza',
            'Lb': 'Libra',
            'Lt': 'Litro'
          },
          inputValue: item.medida,
          showCancelButton: true,
          confirmButtonText: 'Guardar',
          cancelButtonText: 'Cancelar'
        });
        if (!nuevaMedida) return;

        datos[idx] = {
          producto: nuevoProd.trim(),
          cantidad: parseInt(nuevaCant, 10),
          precio: nuevoPrecio.trim(),
          fecha: nuevaFecha.trim(),
          medida: nuevaMedida.trim()
        };
        localStorage.setItem('inventario', JSON.stringify(datos));
        renderTabla();
        Swal.fire({
          icon: 'success',
          title: 'Producto actualizado',
          text: 'Los datos del producto se actualizaron correctamente.',
          confirmButtonColor: '#3085d6'
        });
      }
    });

    document.getElementById('btnAgregar').addEventListener('click', () => {
      window.location.href = 'Inventario.html';
    });

    document.getElementById('btnVenta').addEventListener('click', () => {
      window.location.href = 'Pedidos.html';
    });

    document.getElementById('btnMerma').addEventListener('click', () => {
      window.location.href = 'Desperdicios.html';
    });
  </script>

</body>
</html>